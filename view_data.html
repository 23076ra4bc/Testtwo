<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Multi-Device Data Viewer</title>
    <style>
        .storage-tabs { display: flex; gap: 10px; margin: 20px 0; }
        .tab { padding: 10px 20px; background: #ddd; cursor: pointer; }
        .tab.active { background: #007bff; color: white; }
        .sync-status { padding: 10px; margin: 10px 0; }
        .online { background: #d4edda; }
        .offline { background: #f8d7da; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Multi-Device Data Viewer</h1>
        
        <div class="password-section">
            <input type="password" id="password" placeholder="Enter password" value="admin123">
            <button onclick="checkPassword()">Access Data</button>
        </div>
        
        <div id="content" class="hidden">
            <div class="storage-tabs">
                <button class="tab active" onclick="showStorage('local')">Local Data</button>
                <button class="tab" onclick="showStorage('online')">Online Data</button>
                <button class="tab" onclick="showStorage('sync')">Sync Data</button>
            </div>
            
            <div id="sync-status" class="sync-status"></div>
            
            <!-- Local Storage Tab -->
            <div id="local-tab" class="tab-content active">
                <h3>üì± Local Storage (This Device)</h3>
                <button onclick="exportLocalData()">Export Local Data</button>
                <button onclick="importToOnline()">Upload to Cloud</button>
                <div id="local-data"></div>
            </div>
            
            <!-- Online Storage Tab -->
            <div id="online-tab" class="tab-content">
                <h3>‚òÅÔ∏è Online Storage (All Devices)</h3>
                <button onclick="loadOnlineData()">Refresh Online Data</button>
                <div id="online-data"></div>
            </div>
            
            <!-- Sync Tab -->
            <div id="sync-tab" class="tab-content">
                <h3>üîÑ Sync Between Devices</h3>
                <button onclick="syncAllData()">Sync Now</button>
                <button onclick="clearCloudData()">Clear Cloud Data</button>
                <div id="sync-data"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
    
    <script src="scripts/firebase.js"></script>
    <script src="scripts/storage.js"></script>
    <script src="scripts/main.js"></script>
    
    <script>
        let currentStorage = 'local';
        let onlineData = null;

        function showStorage(type) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(type + '-tab').classList.add('active');
            event.target.classList.add('active');
            currentStorage = type;
            
            if (type === 'online' && !onlineData) {
                loadOnlineData();
            }
        }

        async function loadOnlineData() {
            const status = document.getElementById('sync-status');
            status.innerHTML = 'üîÑ Loading online data...';
            status.className = 'sync-status';
            
            try {
                const result = await OnlineStorage.getAllData();
                
                if (result.success) {
                    onlineData = result.visitors;
                    status.innerHTML = `‚úÖ Online data loaded: ${onlineData.length} visitors`;
                    status.className = 'sync-status online';
                    displayOnlineData(onlineData);
                } else {
                    status.innerHTML = '‚ùå Failed to load online data';
                    status.className = 'sync-status offline';
                }
            } catch (error) {
                status.innerHTML = '‚ùå Error: ' + error.message;
                status.className = 'sync-status offline';
            }
        }

        function displayOnlineData(visitors) {
            const container = document.getElementById('online-data');
            container.innerHTML = '';
            
            if (visitors.length === 0) {
                container.innerHTML = '<p>No online data found.</p>';
                return;
            }
            
            visitors.forEach(visitor => {
                const card = document.createElement('div');
                card.className = 'visitor-card';
                card.innerHTML = `
                    <h4>üì± ${new Date(visitor.data.timestamp).toLocaleString()}</h4>
                    <p><strong>IP:</strong> ${visitor.data.ip}</p>
                    <p><strong>Device:</strong> ${visitor.data.device_info.platform}</p>
                    <p><strong>From:</strong> ${visitor.data.pageUrl}</p>
                `;
                container.appendChild(card);
            });
        }

        async function importToOnline() {
            const localVisitors = GitHubFriendlyStorage.getAllLocalData();
            let imported = 0;
            
            for (const visitor of localVisitors) {
                try {
                    await OnlineStorage.saveData(visitor.data);
                    imported++;
                } catch (error) {
                    console.error('Import error:', error);
                }
            }
            
            alert(`Imported ${imported}/${localVisitors.length} visitors to cloud`);
        }

        async function syncAllData() {
            const status = document.getElementById('sync-status');
            status.innerHTML = 'üîÑ Syncing data...';
            
            // Sync logic here
            status.innerHTML = '‚úÖ Sync completed';
        }
    </script>
</body>
</html>
